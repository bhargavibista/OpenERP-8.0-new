<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
        <record id="view_reason_sale_returns" model="ir.ui.view">
            <field name="name">view.reason.sale.returns</field>
            <field name="model">return.order</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="bista_order_returns.view_sales_return_form" />
            <field name="arch" type="xml">
                <xpath expr="/form/notebook/page[@string='Return Order']/group/group/field[@name='pricelist_id']" position="attributes">
                    <attribute name="widget">selection</attribute>
                </xpath>
                <xpath expr="/form/group/group[1]/field[@name='name']" position="attributes">
                    <attribute name="readonly">1</attribute>
                </xpath>
                <xpath expr="//field[@name='company_id']" position="after">
                   <field name="return_option"/>
               </xpath>
		<xpath expr="/form/group/group[1]/field[@name='source_location']" position="attributes">
                    <attribute name="widget">selection</attribute>
                    <attribute name="required">1</attribute>
                </xpath>
		<xpath expr="/form/group/group[1]/field[@name='return_type']" position="after">
                    <field name="return_reason" required="1" domain="[('module','=','returns'),('active','=',True)]" attrs="{'invisible':[('state','!=','draft')]}" widget="selection"/>
                </xpath>
<!--                <xpath expr="/form/group/group[1]/field[@name='shop_id']" position="after">
                    <field name="return_reason" required="1" domain="[('module','=','returns'),('active','=',True)]" attrs="{'invisible':[('state','!=','draft')]}" widget="selection"/>
                    <field name="show_components" attrs="{'invisible':[('bundle_configuration','=',False)]}" on_change="onchange_show_components(show_components,order_line,return_type,linked_sale_order)"/>
                    <field name="bundle_configuration" invisible="1"/>
                    <field name="generate_label" attrs="{'invisible':[('state','in',('progress','done'))]}"/>
                </xpath> -->
		<xpath expr="/form/group/group[2]/button[@name='refresh_page']" position="before">
                    <!--<field name="return_reason" required="1" domain="[('module','=','returns'),('active','=',True)]" attrs="{'invisible':[('state','!=','draft')]}" widget="selection"/>-->
                    <field name="show_components" attrs="{'invisible':[('bundle_configuration','=',False)]}" on_change="onchange_show_components(show_components,order_line,return_type,linked_sale_order)"/>
<!--                    <field name="generate_label" attrs="{'invisible':[('state','in',('progress','done'))]}"/>-->
                    <field name="refund_type" on_change="onchange_refund_type(refund_type)" attrs="{'required':[('return_type','=','car_return')],'invisible':[('return_type','!=','car_return')]}"/>
                    <field name="bundle_configuration" invisible="1"/>
                </xpath>
                <xpath expr="//button[@name='manual_invoice_return']" position="replace">
                    <!--<attribute name="attrs">{'invisible':['|',('return_type','=','exchange'),('manual_invoice_invisible','=',True)]}</attribute>-->
                </xpath>
                <xpath expr="//button[@name='return_confirm']" position="replace">
                    <!--<attribute name="attrs">{'invisible':['|',('receive','=',True),('return_type','=','exchange')]}</attribute>-->
                </xpath>
                <!--<xpath expr="/form/header/field[@name='state']" position="before">
                   <button name="manual_invoice_return" string="Create Final Invoice(Refund)" icon="gtk-go-forward" type="object" attrs="{'invisible':['|',('return_type','=','exchange'),('manual_invoice_invisible','=',True)]}" />
                   <button name="receive_confirm" string="Receive" icon="gtk-go-forward" type="object" attrs="{'invisible':['|',('receive','=',True),('return_type','=','car_return')]}"/>
                   <button name="deliver_confirm" string="Deliver" icon="terp-gtk-go-back-ltr" type="object" attrs="{'invisible':['|','|',('receive','=',False),('delivered','=',True),('return_type','!=','exchange')]}"/>
                   <button name="return_confirm" string="Receive" icon="gtk-apply" type="object" attrs="{'invisible':['|',('receive','=',True),('return_type','=','exchange')]}"/>
               </xpath>-->
               <xpath expr="/form/header/field[@name='state']" position="before">
<!--                   <button name="manual_invoice_return" string="Create Final Invoice(Refund)" icon="gtk-go-forward" type="object" attrs="{'invisible':['|',('return_type','=','exchange'),'|',('manual_invoice_invisible','=',True),'|',('need_to_charge','=',True),('need_to_cancel','=',True)]}" />-->
                  <button name="receive_confirm" string="Process Order" icon="gtk-go-forward" type="object" attrs="{'invisible':['|','|',('receive','=',True),('return_type','=','car_return'),('state','=','done')]}"/>
                   <button name="deliver_confirm" string="Deliver" icon="terp-gtk-go-back-ltr" type="object" attrs="{'invisible':['|','|',('receive','=',False),('delivered','=',True),('return_type','!=','exchange')]}"/>
                   <!--<button name="return_confirm" string="Receive" icon="gtk-apply" type="object" attrs="{'invisible':['|',('receive','=',True),'|',('return_type','=','exchange'),('device_returned','=',False)]}"/>-->
                   <button name="return_confirm" string="Process Order" icon="gtk-apply" type="object" attrs="{'invisible':['|',('return_type','=','exchange'),('state','=','done')]}"/>
<!--                   <button name="charge_termintion_fees" string="Charge Termination Fees" icon="gtk-apply" type="object" attrs="{'invisible':['|',('need_to_charge','=',False),('state','!=','draft')]}"/>-->
<!--                   <button name="cancel_service" string="Cancel Service" icon="gtk-apply" type="object" attrs="{'invisible':['|',('need_to_cancel','=',False),('state','=','done')]}"/>-->
               </xpath>
		<xpath expr="/form/header/field[@name='state']" position="attributes">
			<attribute name="widget">statusbar</attribute>
			<attribute name="statusbar_visible">draft,progress,email_sent,done</attribute>
		</xpath>
                <!-- To add return type in the onchange function-->
                <xpath expr="/form/group/group[2]/field[@name='linked_sale_order']" position="attributes">
                    <attribute name="on_change">onchange_sale_order(linked_sale_order,linked_serial_no,order_line,return_type,context)</attribute>
                </xpath>
                <!-- To add onchange in return_type field-->
                <xpath expr="/form/group/group[1]/field[@name='return_type']" position="attributes">
                    <attribute name="on_change">onchange_sale_order(linked_sale_order,linked_serial_no,order_line,return_type,context)</attribute>
		    <attribute name="context">{'r_type': True}</attribute>
                </xpath>
                <xpath expr="//group[@name='logistics']/field[@name='receive']" position="after">
                    <field name="email_sent" string="Label Sent" readonly="1" attrs="{'invisible':[('return_type','!=','exchange')]}"/>
                    <field name="receive" string="Received" readonly="1"/>
                    <field name="delivered" readonly="1" attrs="{'invisible':[('return_type','!=','exchange')]}"/>
                </xpath>
                
                <!--<xpath expr="//button[@name='manual_invoice_return']" position="after">
                    <button name="receive_confirm" string="Receive" icon="gtk-go-forward" type="object" attrs="{'invisible':['|',('receive','=',True),'|',('email_sent','=',False),('generate_label','=',True),('return_type','=','car_return')]}"/>
                    <button name="deliver_confirm" string="Deliver" icon="terp-gtk-go-back-ltr" type="object" attrs="{'invisible':['|','|',('receive','=',False),('delivered','=',True),('return_type','!=','exchange')]}"/>
                </xpath>-->
                <xpath expr="/form/notebook/page[@string='History']" position="after">
                    <page string="Shipping Info" >
                        <field name="carrier_tracking_ref"/>
			<field name="label_package_barcode"/>
                        <newline/>
                        <separator string="Shipping Detail" colspan="4"/>
                        <field name="shipping_info" colspan="8" nolabel="1" readonly="1"/>
                     </page>
                </xpath>
                <xpath expr="/form/notebook/page[@string='History']/field[@name='invoice_ids']" position="attributes">
                    <attribute name="attrs">{'invisible':[('return_type','=','exchange')]}</attribute>
                </xpath>
                <xpath expr="/form/notebook/page[@string='History']/separator[@string='Invoices']" position="attributes">
                    <attribute name="attrs">{'invisible':[('return_type','=','exchange')]}</attribute>
                </xpath>
		<xpath expr="/form/notebook/page[@string='Return Order']/field[@name='order_line']/form/notebook/page[@string='Order Line']/group/field[@name='discount']" position="replace">
			<field name="sale_line_id" invisible="1"/>
                </xpath>
                <xpath expr="/form/notebook/page[@string='Return Order']/field[@name='order_line']/form/notebook/page[@string='Order Line']/group/field[@name='serial_no']" position="replace">
                </xpath>
                <xpath expr="/form/notebook/page[@string='Return Order']/field[@name='order_line']/form/notebook/page[@string='Order Line']/group/field[@name='account_id']" position="replace">
                </xpath>
                <xpath expr="/form/notebook/page[@string='Return Order']/field[@name='order_line']/form/notebook/page[@string='Order Line']/group/field[@name='tax']" position="replace">
                </xpath>
                <xpath expr="/form/notebook/page[@string='Return Order']/field[@name='order_line']/form/notebook/page[@string='Order Line']/group/field[@name='tax_id']" position="replace">
                </xpath>
                <xpath expr="/form/notebook/page[@string='Return Order']/field[@name='order_line']/form/notebook/page[@string='Order Line']/group/separator[@string='Taxes']" position="replace">
                </xpath>
                <xpath expr="/form/notebook/page[@string='Return Order']/field[@name='order_line']/tree[@string='Sales Return Lines']/field[@name='discount']" position="replace">
                </xpath>
                <xpath expr="/form/notebook/page[@string='Return Order']/field[@name='order_line']/tree[@string='Sales Return Lines']/field[@name='account_id']" position="replace">
                </xpath>
                <xpath expr="/form/notebook/page[@string='Return Order']/field[@name='order_line']/form/notebook/page[@string='Order Line']/group/field[@name='product_id']" position="attributes">
                    <attribute name="required">1</attribute>
                </xpath>
		<xpath expr="/form/notebook/page[@string='Return Order']/field[@name='order_line']/form/notebook/page[@string='Order Line']/group/field[@name='price_unit']" position="attributes">
                    <attribute name="on_change">onchange_price_unit(price_unit,product_uom_qty,parent.refund_type,sale_line_id,context)</attribute>
                </xpath>
		<xpath expr="/form/notebook/page[@string='History']/field[@name='picking_ids']" position="replace">
                    <field colspan="4" name="picking_ids">
                        <form string="Pickings">
                            <group>
                            <field name="partner_id" on_change="onchange_partner_in(partner_id)"/>
                            <field name="backorder_id" readonly="1" attrs="{'invisible': [('backorder_id','=',False)]}"/>
                            <field name="date"/>
                            <field name="origin"/>
                            <field name="state"/>
                            </group>
                            <newline/>
                            <notebook>
                                <page string="Products">
                                    <field name="move_lines" nolabel="1" context="{'address_in_id': partner_id, 'form_view_ref':'view_move_picking_form', 'tree_view_ref':'view_move_picking_tree', 'picking_type': 'internal'}"/>
                                    <newline/>
                                    <field name="note" placeholder="Add an internal note..." class="oe_inline"/>
                                </page>
                                <page string="Additional Info">
                                    <group>
                                    <group>
                                        <field name="move_type"/>
                                        <!--<field name="type" invisible="1"/> cox gen2-->
                                        <!--<field name="auto_picking" groups="base.group_user"/> cox gen2-->
                                    </group>
                                    <group>
                                        <field name="company_id" groups="base.group_multi_company" widget="selection"/>
                                        <field name="date_done" groups="base.group_no_one"/>
                                    </group>
                                    </group>
                                </page>
                            </notebook>
                        </form>
                        <tree string="Pickings" colors="blue:state == 'draft';grey:state == 'cancel';red:state not in ('cancel', 'done') and date &lt; current_date">
                            <field name="name"/>
                            <field name="partner_id" string="Customer"/>
                            <field name="origin"/>
                            <field name="date"/>
                            <field name="backorder_id"/>
                            <field name="state"/>
                            <button name="barcode_scanning_returns" type="object" string="BarCode Scanning" icon="gtk-go-forward"/>
                        </tree>
                    </field>
                </xpath>

          
            </field>
        </record>
        <!--<record id="view_hide_some_fields_returns" model="ir.ui.view">
            <field name="name">view.hide.some.fields.returns</field>
            <field name="model">return.order</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="bista_order_returns.view_order_form_inherit_returns" />
            <field name="arch" type="xml">
                <xpath expr="//page[@string='Authorize.Net Payment']" position="attributes">
                    <attribute name="attrs">{'invisible':[('return_type','=','exchange')]}</attribute>
                </xpath>
            </field>
        </record>-->
        <!-- To add Return Reason in the return tree view -->
        <record id="view_return_tree_changes" model="ir.ui.view">
            <field name="name">view.return.tree.changes</field>
            <field name="model">return.order</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="bista_order_returns.view_sales_return_tree" />
            <field name="arch" type="xml">
                <xpath expr="/tree/field[@name='user_id']" position="after">
                    <field name="return_reason"/>
                </xpath>
            </field>
        </record>
        <!--  this record is added to show return report  -->
        <report auto="False" id="report_return_order" model="return.order" name="return.order"
                rml="cox_communication/report/return_order.rml" string="Return Orders"
                usage="default"/>
<!--New action to show returns in the Partner View-->
        <record id="action_partner_sales_return" model="ir.actions.act_window">
           <field name="name">Sales Return</field>
           <field name="type">ir.actions.act_window</field>
           <field name="res_model">return.order</field>
           <field name="view_type">form</field>
           <field name="view_mode">tree,form</field>
           <field name="view_id" ref="bista_order_returns.view_sales_return_tree"/>
            <field name="search_view_id" ref="bista_order_returns.sale_returns_search_form_view"/>
       </record>
<!-- Button to show Sales Returns in the Partner View-->
        <record id="res_partner_returns_view" model="ir.ui.view">
            <field name="name">res.partner.returns.view</field>
            <field name="model">res.partner</field>
            <field name="inherit_id" ref="base.view_partner_form" />
            <field name="priority" eval="20"/>
            <field name="arch" type="xml">
                <xpath expr="//div[@name='buttons']" position="inside">
                    <button name="%(action_partner_sales_return)d" type="action"
                        string="Sales Returns"
                        context="{'search_default_partner_id': active_id,'default_partner_id': active_id}" attrs="{'invisible': [('customer', '=', False)]}"/>
                </xpath>
            </field>
        </record>
	<record id="bista_order_returns.view_sales_return_tree" model="ir.ui.view">
            <field name="name">view.sales.return.tree</field>
            <field name="model">return.order</field>
            <field name="type">tree</field>
            <field name="priority">2</field>
            <field name="arch" type="xml">
                <tree string="Return Orders" colors="black:state=='done';grey:state=='cancel';blue:state in ('waiting_date','manual');red:email_send_2_week != False and current_date&gt;=email_send_2_week">
                    <field name="name"/>
                    <field name="date_order"/>
                    <field name="source_location" string="Destination Location"/>
                    <field name="partner_id"/>
                    <field name="linked_sale_order" select="1"/>
<!--                    <field name="incoming_exchange"/>
                    <field name="outgoing_exchange"/>-->
                    <field name="user_id"/>
                    <field name="return_type" select="1"/>
<!--                    <field name="picked_rate" widget="progressbar"/>
                    <field name="invoiced_rate" widget="progressbar"/>-->
                    <field name="amount_untaxed" sum="Total Tax Excluded"/>
                    <field name="amount_total" sum="Total Tax Included"/>
                    <field name="state"/>
                    <field name="email_send_2_week" invisible="1"/>
                </tree>
            </field>
	</record>	

    </data>
</openerp>
